{
  "version": "2.0.0",
  "tasks": [
    {
      "type": "shell",
      "label": "Start Development Stack",
      "command": "if [ ! -f ${workspaceFolder}/.env ]; then echo 'Error: .env file not found. Copy .env.example to .env and configure it.'; exit 1; fi && docker compose -f ${workspaceFolder}/docker/docker-compose.dev.yml up --build",
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "isBackground": true,
      "problemMatcher": {
        "owner": "docker-compose",
        "pattern": {
          "regexp": "^(Error|ERROR|error):\\s+(.*)$",
          "severity": 1,
          "message": 2
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": "^\\[\\+\\] (Building|Running)",
          "endsPattern": "(Application startup complete|Uvicorn running|Container .* Started)"
        }
      },
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": true
      },
      "detail": "Start Ragtime development stack with hot-reload"
    },
    {
      "type": "shell",
      "label": "Stop Development Stack",
      "command": "docker compose -f ${workspaceFolder}/docker/docker-compose.dev.yml down",
      "isBackground": false,
      "problemMatcher": {
        "owner": "docker-compose",
        "pattern": {
          "regexp": "^(Error|ERROR|error):\\s+(.*)$",
          "severity": 1,
          "message": 2
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": "^\\[\\+\\] Running",
          "endsPattern": "(Network .* Removed|removed)"
        }
      },
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      },
      "detail": "Stop all Ragtime containers"
    },
    {
      "type": "shell",
      "label": "Rebuild Development Stack",
      "command": "if [ ! -f ${workspaceFolder}/.env ]; then echo 'Error: .env file not found. Copy .env.example to .env and configure it.'; exit 1; fi && docker compose -f ${workspaceFolder}/docker/docker-compose.dev.yml down && docker compose -f ${workspaceFolder}/docker/docker-compose.dev.yml build --no-cache && docker compose -f ${workspaceFolder}/docker/docker-compose.dev.yml up",
      "isBackground": true,
      "problemMatcher": {
        "owner": "docker-compose",
        "pattern": {
          "regexp": "^(Error|ERROR|error):\\s+(.*)$",
          "severity": 1,
          "message": 2
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": "^\\[\\+\\] (Building|Running)",
          "endsPattern": "(Application startup complete|Uvicorn running)"
        }
      },
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": true
      },
      "detail": "Full rebuild with cache clear"
    }
  ]
}
